<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Management</title>
    <link rel="stylesheet" href="../../public/user/css/employees.css">
</head>

<body>
    <div class="sidebar">
        <h1>System Management</h1>
        <a href="#" id="customerManagementLink">Customer Management</a>
        <a href="#" id="reportInvoices">Report invoices</a>
        <a href="#" id="itemManagement"> Item Management</a>
    </div>
    <div class="main-content">
        <!-- Customer Management Section -->
        <div id="customer-management" class="content-section">
            <h2>Customer Management</h2>
            <div class="function-bar">
                <form method="GET" action="/employees/customer/search">
                    <input type="text" name="criteria" placeholder="Search by ID, email, or phone" required>
                    <button type="submit">Search</button>
                </form>
                <!-- Nút hiển thị popup -->
                <button id="openPopup">Add Customer</button>

                <!-- Popup -->
                <div class="popup-overlay" id="popup">
                    <div class="popup-content">
                        <span class="close-popup" id="closePopup">&times;</span>
                        <h2>Đăng ký thông tin</h2>
                        <form id="infoForm" method="POST" action="/employees/add">
                            <table>
                                <tr>
                                    <th><label for="name">Họ và tên:</label></th>
                                    <td><input type="text" name="name" id="name" placeholder="Nhập họ và tên" required></td>
                                </tr>
                                <tr>
                                    <th><label for="phone">Số điện thoại:</label></th>
                                    <td><input type="tel" name="phone" id="phone" placeholder="Nhập số điện thoại" required></td>
                                </tr>
                                <tr>
                                    <th><label for="email">Email:</label></th>
                                    <td><input type="email" name="email" id="email" placeholder="Nhập email" required></td>
                                </tr>
                                <tr>
                                    <th><label for="identity">CMND/CCCD:</label></th>
                                    <td><input type="text" name="identity" id="identity" placeholder="Nhập số CMND/CCCD" required></td>
                                </tr>
                                <tr>
                                    <th><label>Giới tính:</label></th>
                                    <td><input type="radio" id="male" name="gender" value="M" required checked><label
                                            for="male">Nam</label>
                                        <input type="radio" id="female" name="gender" value="M" required><label
                                            for="female">Nữ</label>
                                    </td>
                                </tr>
                            </table>
                            <div class="half-width">
                                <button type="submit" class="submit-btn">Gửi</button>
                                <button type="button" class="cancel-btn" id="cancelPopup">Hủy</button>
                            </div>
                            <p id="success-message" style="font-weight: bold; margin-top: 10px;"></p>
                        </form>
                    </div>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Customer ID</th>
                        <th>Name</th>
                        <th>Phone Number</th>
                        <th>Email</th>
                        <th>Identity Card</th>
                        <th>Gender</th>
                        <th>Member Card Number</th>
                        <th>Card Type</th>
                        <th>Accumulated Spending</th>
                        <th>Created At</th>
                        <th>Support Employee ID</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (message) { %>
                        <tr>
                        <td colspan="12" style="text-align: center; color: #d6c3c3;"><%= message %></td>
                    </tr>

                            <% } else { %>
                                <% customers.forEach(customer=> { %>
                                    <tr data-customer-id="<%= customer.customer_id %>">
                                        <td><span>
                                                <%= customer.customer_id %>
                                            </span></td>
                                        <td contenteditable="false">
                                            <%= customer.name %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.phone_number %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.email %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.identity_card %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.gender %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.member_card_number %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.card_type %>
                                        </td>
                                        <td contenteditable="false">
                                            <%= customer.accumulated_spending %>
                                        </td>
                                        <td><span>
                                                <%= customer.created_at %>
                                            </span></td>
                                        <td><span>
                                                <%= customer.support_employee_id %>
                                            </span></td>
                                        <td>
                                            <button class="edit-save-btn">Edit</button> <br>
                                            <form method="POST" action="/employees/<%= customer.customer_id %>/delete">
                                                <button type="submit">Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <% }); %>
                                        <% } %>
                </tbody>
            </table>
        </div>

        <!-- Branch Revenue Report Section -->
        <!-- Report Invoices Section -->
        <div id="report-invoices" class="content-section">
    <h2>Report Invoices</h2>

    <!-- Filter Form -->
    <form method="GET" action="/employees/report-invoices">
        <label for="name">Customer Name:</label>
        <input type="text" name="name" placeholder="Enter customer name" />

        <label for="phone_number">Phone Number:</label>
        <input type="text" name="phone_number" placeholder="Enter phone number" />

        <label for="year">Year:</label>
        <input type="number" name="year" placeholder="Enter year" />

        <label for="month">Month:</label>
        <select name="month">
            <option value="all">All</option>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select>

        <button type="submit">Filter</button>
    </form>

    <!-- Displaying Filtered Invoices -->
    <table>
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Order Date</th>
                <th>Amount</th>
                <th>Total Amount</th>
                <th>Payment Method</th>
                <th>Customer Name</th>
                <th>Phone Number</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            <% invoices.forEach(invoice => { %>
                <tr>
                    <td><%= invoice.order_id %></td>
                    <td><%= invoice.order_date %></td>
                    <td><%= invoice.amount %></td>
                    <td><%= invoice.total_amount %></td>
                    <td><%= invoice.payment_method %></td>
                    <td><%= invoice.name %></td>
                    <td><%= invoice.phone_number %></td>
                    <td><%= invoice.email %></td>
                </tr>
            <% }); %>
        </tbody>
    </table>
</div>
        <!-- Item Management Section -->
        <div id="item-management" class="content-section">
    <h2>Item Management</h2>
    <!-- Item Search Form -->
    <form class="title" method="GET" action="/employees/items/search">
        <input type="text" name="itemName" placeholder="Search by Name" />
        
        <select name="categoryId">
            <option value="all">All Categories</option>
            <!-- Populate categories dynamically -->
            <% categories.forEach(category => { %>
                <option value="<%= category.category_id %>"><%= category.category_name %></option>
            <% }); %>
        </select>

        <input type="number" name="maxPrice" placeholder="Max Price" min="0" />

        <button class="search-btn" type="submit">Search</button>
    </form>

    <!-- Items Table -->
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% items.forEach(item => { %>
                <tr data-item-id="<%= item.item_id %>">
                    <td contenteditable="false"><%= item.item_name %></td>
                    <td contenteditable="false"><%= item.category_name %></td>
                    <td contenteditable="false"><%= item.price %></td>
                    <td contenteditable="false"><%= item.status %></td>
                    <td>
                        <button class="items-edit-save-btn">Edit</button>
                        <form method="POST" action="/employees/items/<%= item.item_id %>/delete">
                            <button type="submit" class="items-delete-btn">Delete</button>
                        </form>
                    </td>
                </tr>
                
            <% }); %>
        </tbody>
    </table>
    <!-- Nút "Thêm Món Ăn" để mở popup -->
<button id="addItemBtn">Thêm Món Ăn</button>
<!-- Popup nhập thông tin món ăn -->
<div id="addItemPopup" style="display: none;">
    <div class="popup-content">
        <h3>Thêm Món Ăn Mới</h3>
        <form id="addItemForm">
            <label for="itemName">Tên Món Ăn:</label>
            <input type="text" id="itemName" name="itemName" required />

            <label for="itemCategory">Danh Mục:</label>
            <select id="itemCategory" name="itemCategory" required>
                <option value="">Chọn Danh Mục</option>
                <% categories.forEach(category => { %>
                    <option value="<%= category.category_id %>"><%= category.category_name %></option>
                <% }); %>
            </select>

            <label for="itemPrice">Giá:</label>
            <input type="number" id="itemPrice" name="itemPrice" required min="0" />
           

            <button type="submit">Thêm Món Ăn</button>
            <button type="button" id="closePopup">Hủy</button>
        </form>
    </div>
</div>
</div>

    </div>

    <!-- External JS for Event Handling -->
    <script src="../../public/admin/js/employees.js"></script>
</body>

</html>